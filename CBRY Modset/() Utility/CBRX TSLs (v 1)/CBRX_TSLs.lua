local cbrxTSLs = {}

cbrxTSLs["CIVILIZATION_BABYLON"] = {X = 46, Y = 0, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_COLONIALCANADA"] = {X = 87, Y = 51, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_CLKIMBERLEY"] = {X = 53, Y = 14, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_PHILIPPINES"] = {X = 53, Y = 30, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_BLACKFOOTFIRSTNATION"] = {X = 75, Y = 53, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_MC_AYYUBIDS"] = {X = 20, Y = 29, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_BUCCANEER"] = {X = 86, Y = 33, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_IRELAND"] = {X = 1, Y = 48, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_CHILE"] = {X = 87, Y = 11, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_HYP_FINLAND"] = {X = 18, Y = 53, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_JFD_JAPAN_MEIJI"] = {X = 60, Y = 42, S = "T", O = "F"}
cbrxTSLs["CIVILIZATION_JFD_ARMENIA"] = {X = 26, Y = 38, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_TEXAS"] = {X = 77, Y = 39, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_MC_ASHANTI"] = {X = 10, Y = 19, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_MC_MAORI"] = {X = 67, Y = 7, S = "T", O = "T"}
cbrxTSLs["CIVILIZATION_OW_PRC_MAO"] = {X = 49, Y = 46, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_BURMA"] = {X = 43, Y = 30, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_TIMURIDS_MOD"] = {X = 33, Y = 41, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_PORTUGAL"] = {X = 3, Y = 34, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_POLAND"] = {X = 16, Y = 44, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_INCA"] = {X = 85, Y = 21, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_ZULU"] = {X = 20, Y = 5, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_FRANCE"] = {X = 6, Y = 41, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_LHASA"] = {X = 38, Y = 37, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_ICELAND"] = {X = 2, Y = 60, S = "T", O = "T"}
cbrxTSLs["MINOR_CIV_NORWAY"] = {X = 11, Y = 53, S = "T", O = "F"}
cbrxTSLs["MINOR_CIV_ROME"] = {X = 13, Y = 36, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_SPARTA"] = {X = 16, Y = 34, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_SOVIET_UNION"] = {X = 23, Y = 48, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_MOROCCO"] = {X = 3, Y = 27, S = "T", O = "F"}
cbrxTSLs["MINOR_CIV_CARTHAGE"] = {X = 11, Y = 31, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_ETHIOPIA"] = {X = 21, Y = 21, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_KONGO"] = {X = 15, Y = 15, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_JERUSALEM"] = {X = 22, Y = 31, S = "F", O = "F"}
cbrxTSLs["CIVILIZATION_MUGHAL"] = {X = 36, Y = 33, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_SIBIR"] = {X = 32, Y = 51, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_MONGOLIA"] = {X = 43, Y = 50, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_YAKUTIA"] = {X = 51, Y = 54, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_KOREA"] = {X = 54, Y = 46, S = "F", O = "F"}
-- cbrxTSLs["MINOR_CIV_CHAMPA"] = {X = 48, Y = 30, S = "T", O = "F"}
cbrxTSLs["MINOR_CIV_INDONESIA"] = {X = 49, Y = 17, S = "T", O = "T"}
cbrxTSLs["MINOR_CIV_SYDNEY"] = {X = 62, Y = 7, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_HAWAII"] = {X = 65, Y = 40, S = "T", O = "T"}
cbrxTSLs["MINOR_CIV_INUIT"] = {X = 71, Y = 59, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_SIOUX"] = {X = 79, Y = 50, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_LINCOLN_AMERICA"] = {X = 87, Y = 45, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_MAYA"] = {X = 80, Y = 34, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_BRAZIL"] = {X = 95, Y = 17, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_ARGENTINA"] = {X = 91, Y = 12, S = "F", O = "F"}
cbrxTSLs["MINOR_CIV_COLOMBO"] = {X = 39, Y = 20, S = "T", O = "T"}

--local observerTechs = {GameInfoTypes["TECH_POTTERY"].ID, GameInfoTypes["TECH_ANIMAL_HUSBANDRY"].ID, GameInfoTypes["TECH_MINING"].ID, GameInfoTypes["TECH_CALENDAR"].ID, GameInfoTypes["TECH_MASONRY"].ID, GameInfoTypes["TECH_COMPASS"].ID}
-- Pottery, Animal Husbandry, Mining, Calendar, Masonry, Compass
local observerTechs = {1, 2, 4, 6, 7, 10}
local sailing = GameInfoTypes["TECH_SAILING"]
local optics = GameInfoTypes["TECH_OPTICS"]
local bronze = GameInfoTypes["TECH_BRONZE_WORKING"]

function addSailing(iPlayer)
	if Game.GetGameTurn() > 2 then return end
	local player = Players[iPlayer]
	if not player then return end
	local sCivilizationType = GameInfo.Civilizations[player:GetCivilizationType()].Type
	if not sCivilizationType then return end
	if not cbrxTSLs[sCivilizationType] then return end

	for v in player:Units() do
		if v:GetUnitType() == 0 then
			v:SetXY(cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
		end
	end

	local pTeam = Teams[player:GetTeam()]

	if cbrxTSLs[sCivilizationType].S == "T" then
		pTeam:SetHasTech(sailing, true)
		pTeam:SetHasTech(optics, true)
		pTeam:SetHasTech(bronze, true)
	end
end
GameEvents.PlayerDoTurn.Add(addSailing)

function setTSLs()
	if Game.GetGameTurn() > 2 then return end
	for iPlayer = 0, GameDefines.MAX_PLAYERS - 1, 1 do
		local player = Players[iPlayer]
		if player and (not player:IsBarbarian()) and player:IsAlive() then
			local sCivilizationType = nil
			if player:IsMinorCiv() then
				sCivilizationType = GameInfo.MinorCivilizations[player:GetMinorCivType()].Type
			else
				sCivilizationType = GameInfo.Civilizations[player:GetCivilizationType()].Type
			end

			local pTeam = Teams[player:GetTeam()]
			local currentTeamID = pTeam:GetID()

			if iPlayer == 0 then
				for index, val in ipairs(observerTechs) do
					pTeam:SetHasTech(val, true)
				end
			end

			for i = 0, Map.GetNumPlots() - 1, 1 do
				local plot = Map.GetPlotByIndex(i)
				local oldVisibility = plot:GetVisibilityCount(currentTeamID)

				if oldVisibility > 0 then
					plot:ChangeVisibilityCount(currentTeamID, -1, -1, true, true)
					plot:SetRevealed(currentTeamID, false)
					plot:UpdateFog()
				end
			end
			Game.UpdateFOW(true)
			UI.RequestMinimapBroadcast()

			if cbrxTSLs[sCivilizationType] then
				print(sCivilizationType)
				for v in player:Units() do
					v:SetXY(cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
				end

				player:InitUnit(1, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)
				-- player:InitUnit(81, cbrxTSLs[sCivilizationType].X, cbrxTSLs[sCivilizationType].Y)

				if cbrxTSLs[sCivilizationType].O == "T" then
					local worker = false

					for u in player:Units() do
						if u:GetUnitType() == 83 then
							local newTrireme = player:InitUnit(22, u:GetX(), u:GetY())
							newTrireme:JumpToNearestValidPlot()
							u:Kill()
						elseif u:GetUnitType() == 1 and (cbrxTSLs[sCivilizationType].S == "T" or worker == false) then
							local newWorkBoat = player:InitUnit(2, u:GetX(), u:GetY())
							newWorkBoat:JumpToNearestValidPlot()
							u:Kill()
							worker = true
						end
					end
				end
			end

		end
	end
end
Events.SequenceGameInitComplete.Add(setTSLs)